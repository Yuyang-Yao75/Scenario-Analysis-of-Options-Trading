# 情景分析：期权持仓风险评估

该项目用于对期权组合进行情景分析，评估在标的价格和波动率变化下的盈亏、保证金以及希腊值暴露情况。工具基于 **iFinD** 数据接口，结合 `pandas`、`numpy`、`scipy` 与 `xlsxwriter` 等库，实现自动化的风险测算与报表生成。

## 功能特点
- **自动登录 iFinD**：连接金融数据接口以获取标的与期权行情。
- **数据预处理**：对持仓表进行完整性检查并在必要时备份。
- **情景分析**：对多标的进行价格与波动率双变量情景测算，输出盈亏矩阵。
- **保证金计算**：按标的及组合层面计算不同情景下的保证金需求。
- **希腊值评估**：计算 Delta、Gamma、Vega、Theta 等敏感度指标。
- **报表导出**：为每个标的及组合生成独立的 Excel 报表。

## 环境要求
- Python 3.8+
- 主要依赖：`pandas`、`numpy`、`scipy`、`matplotlib`、`xlsxwriter`、`iFinDPy`
- 需拥有有效的 iFinD 账号与权限

## 安装
```bash
pip install pandas numpy scipy matplotlib xlsxwriter iFinDPy
```
## 使用方法

1. 在项目根目录准备 `期权持仓表.csv`，其中包含期权合约代码与数量。  
2. 通过设置 `SESSION` 变量选择分析时段（盘前、盘中、盘后）。  
3. 运行主脚本：  

   ```bash
   python 情景分析.py
   ```
4.	程序会根据当前日期生成 YYYY-MM-DD/ 目录，并在其中输出情景分析报表。
## 文件结构
```bash
情景分析.py          # 主程序
期权持仓表.csv        # 输入持仓表
YYYY-MM-DD/          # 每日输出目录
└── YYYY-MM-DD_情景分析.xlsx
README.md           # 项目说明
```

## 注意事项
- 首次运行或更新 期权持仓表.csv 后，请删除自动生成的 期权持仓表备份.csv，以避免读取旧数据。
- 盘中/盘前进行情景分析，请在数据源就绪后执行。
- 含有持仓与敏感度等信息，使用时应注意保密。